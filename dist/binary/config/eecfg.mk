#
# eecfg.in
#

# this file contains the rules for the generation of the ee_libcfg.h
# that will go inside the pkg directory

# Step 4
GENERATECFG_ALLCONF= $(addprefix generatecfg_conf_, $($(DIST)))

MYCFG = ee_$(DIST)/pkg/ee_libcfg.h

.PHONY: make_generatecfg
make_generatecfg: ee_$(DIST)/pkg/ee_libcfg.h
	@echo ee_libcfg.h up2date.


ee_$(DIST)/pkg/ee_libcfg.h: ee_$(DIST)/pkg config/eecfg.mk
	@echo Generating $(MYCFG)...
	@rm -f $(MYCFG)
	@echo \/\* ee_libcfg.h - Copyright 2005 Evidence Srl \*\/ >> $(MYCFG)
	@echo \/\* This file has been automatically generated by the makedist scripts \*\/ >> $(MYCFG)
	@echo >> $(MYCFG)
	@echo \/\* Choose one of the following \(here or in a file included before ee.h\) >> $(MYCFG)
	@echo and then include this file in the application\'s eecfg.h \*\/ >> $(MYCFG)
	@for x in $($(DIST)); do echo \/\/\#define __CONFIG_$${x}__ >> $(MYCFG); done
	@echo >> $(MYCFG)
	@$(foreach c, $($(DIST)), make --no-print-directory -C . generatecfg_options_$(c); )

generatecfg_options_%:
	@echo \#ifdef __CONFIG_$*__                 >> $(MYCFG);
	for x in $($*); do                                      \
	                  echo \#ifndef $${x}      >> $(MYCFG); \
	                  echo \#define $${x}      >> $(MYCFG); \
	                  echo \#endif             >> $(MYCFG); \
                          done;
	$(call generate_allsymbols_eecfg,>> $(MYCFG),$*);
	echo \#endif                               >> $(MYCFG);
	echo                                       >> $(MYCFG);
